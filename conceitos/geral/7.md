QKern — ABI Oficial (ABI.md)

Este documento define a Application Binary Interface (ABI) do kernel QKern, servindo como contrato rígido entre o kernel e o userspace do QuackOS. Nenhuma funcionalidade fora deste documento deve ser assumida.


---

1. Princípios da ABI

Estável desde a versão inicial

Simples e explícita

Inspirada em UNIX, mas não POSIX-completa

Todas as syscalls têm nomes curtos em português



---

2. Arquitetura

CPU: x86-64

Modo: long mode

Instrução de entrada: syscall

Retorno: registrador RAX



---

3. Convenção de Chamada

Registradores

Uso	Registrador

Número da syscall	RAX
Arg 1	RDI
Arg 2	RSI
Arg 3	RDX
Arg 4	R10
Arg 5	R8
Arg 6	R9



---

4. Valores de Retorno

Sucesso: valor >= 0

Erro: valor negativo


Erros comuns:

-1 → erro genérico

-2 → argumento inválido

-3 → permissão negada



---

5. Syscalls Oficiais

5.1 SIS_LER (1)

ssize_t sis_ler(int fd, void *buf, size_t tam);


---

5.2 SIS_ESCREVER (2)

ssize_t sis_escrever(int fd, const void *buf, size_t tam);


---

5.3 SIS_ABRIR (3)

int sis_abrir(const char *caminho, int flags);


---

5.4 SIS_FECHAR (4)

int sis_fechar(int fd);


---

5.5 SIS_MAPEAR (5)

void *sis_mapear(void *addr, size_t tam, int prot);


---

5.6 SIS_EVENTO (6)

int sis_evento(void *buf, size_t tam);


---

6. Validação de Ponteiros

Todo ponteiro vindo do userspace deve ser validado

Ponteiros inválidos retornam erro

Nunca causar kernel panic



---

7. Isolamento

Userspace nunca acessa memória do kernel

Page fault em acesso ilegal encerra o processo



---

8. Compatibilidade Futura

Novas syscalls só podem ser adicionadas

Números existentes nunca mudam

Remoções são proibidas



---

9. O que NÃO faz parte da ABI

Threads avançadas

Sinais complexos

POSIX completo

IO assíncrono



---

10. Identidade do Projeto

A ABI do QKern é curta, legível e em português por escolha consciente. Qualquer tentativa de "internacionalização" ou expansão excessiva é considerada quebra de identidade.


---

Fim do documento.