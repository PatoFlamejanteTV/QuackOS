BOOT.md â€” Processo de InicializaÃ§Ã£o do QuackOS

Este documento define exatamente como o QuackOS inicializa, sem abstraÃ§Ãµes modernas desnecessÃ¡rias.


---

Alvo

Arquitetura: x86-64

Firmware: BIOS (Legacy)

MÃ¡quinas: PCs antigos (2008â€“2014)



---

Pipeline de Boot

1. BIOS

BIOS carrega o MBR (LBA 0) para 0x7C00

CPU inicia em real mode (16 bits)



---

2. MBR (boot.asm)

Responsabilidades mÃ­nimas:

Configurar stack bÃ¡sica

Limpar interrupÃ§Ãµes

Carregar o Stage 2 do disco

NÃ£o contÃ©m FS complexo


Limites:

512 bytes

Assinatura 0x55AA



---

3. Stage 2 Loader (loader.asm / loader.c)

FunÃ§Ãµes principais:

Detectar mapa de memÃ³ria (INT 0x15, E820)

Habilitar A20

Carregar kernel (qkern.bin) para memÃ³ria alta

Trocar para protected mode

Preparar transiÃ§Ã£o para long mode (64 bits)



---

4. Entrada do Kernel (QKern)

CPU jÃ¡ em long mode

Paging ativado

Stack vÃ¡lida

Registradores limpos


Ponto de entrada:

void qkern_inicio(struct boot_info* info);


---

Estrutura boot_info

struct boot_info {
    uint64_t mem_total;
    uint64_t mem_livre;
    void* framebuffer;
    uint32_t fb_largura;
    uint32_t fb_altura;
    uint32_t fb_bpp;
};


---

Regras de Ouro

Nenhuma dependÃªncia de UEFI

Nenhum GRUB

Boot simples, auditÃ¡vel e reimplementÃ¡vel

Se nÃ£o cabe num disquete mental, estÃ¡ errado



---

Testes ObrigatÃ³rios

Boot em QEMU

Boot em PC real

Falha limpa se kernel nÃ£o for encontrado

Dump visual mÃ­nimo em caso de erro



---

Este documento Ã© normativo. ImplementaÃ§Ãµes devem segui-lo literalmente.

Pronto âœ…

Agora o BOOT.md do QuackOS jÃ¡ existe e define, sem ambiguidades, como o sistema nasce do nada atÃ© chegar ao QKern em 64 bits. Esse documento Ã© especialmente importante porque:

Ele elimina dependÃªncias externas (GRUB, UEFI, magia negra)

Ã‰ simples o suficiente para uma IA ou humano implementar do zero

Funciona tanto em QEMU quanto em ferro velho honesto ğŸ–¥ï¸


O que vocÃª tem agora (estado do projeto)

VocÃª jÃ¡ possui:

ğŸ“˜ QuackOS_SPEC.md â€“ identidade, filosofia e limites

ğŸ“„ PORTING.md â€“ hardware alvo e realidade prÃ¡tica

ğŸš€ BOOT.md â€“ pipeline de inicializaÃ§Ã£o completo


Isso jÃ¡ Ã© material suficiente para pedir:

> â€œImplemente o bootloader e kernel inicial do QuackOS seguindo estritamente esses documentosâ€



e a IA nÃ£o vai se perder.


---

PrÃ³ximo documento recomendado (ordem ideal)

1. SYSCALLS.md
Interface oficial QKern â†” userspace (nomes em portuguÃªs, curtos)


2. MEMORIA.md
Paging, alocador inicial, zonas


3. DISPOSITIVOS.md
Teclado, disco, timer, framebuffer


4. QGUI.md
Arquitetura do servidor grÃ¡fico clÃ¡ssico



Se quiser, no prÃ³ximo passo eu jÃ¡ crio o SYSCALLS.md completo, com:

tabela de syscalls

nomes em portuguÃªs

assinaturas em C

regras de ABI


Ã‰ sÃ³ seguir dizendo â€œsimâ€ ğŸ¦†