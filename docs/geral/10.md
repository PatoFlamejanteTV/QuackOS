SYSCALLS.md — Interface de Sistema do QKern

Este documento define a API oficial de syscalls do kernel QKern para o userspace do QuackOS.

As syscalls seguem a filosofia UNIX:

poucas

simples

composáveis

nomes curtos


Com identidade em português.


---

Convenções Gerais

Arquitetura: x86-64

Modo: long mode

Instrução: syscall

ABI inspirada em Linux x86-64


Registradores

Uso	Registrador

número da syscall	RAX
arg1	RDI
arg2	RSI
arg3	RDX
arg4	R10
arg5	R8
arg6	R9
retorno	RAX


Erro:

retorno negativo



---

Tabela de Syscalls

0x01 — sair

Finaliza o processo atual.

long sair(int codigo);


---

0x02 — ler

Lê dados de um descritor.

long ler(int fd, void* buf, long tam);


---

0x03 — escrever

Escreve dados em um descritor.

long escrever(int fd, const void* buf, long tam);


---

0x04 — abrir

Abre um arquivo.

long abrir(const char* caminho, int flags);


---

0x05 — fechar

Fecha um descritor.

long fechar(int fd);


---

0x06 — criar

Cria arquivo ou nó especial.

long criar(const char* caminho, int tipo);


---

0x07 — mapear

Mapeia memória no processo.

long mapear(void* addr, long tam, int prot);


---

0x08 — desmapear

Remove mapeamento.

long desmapear(void* addr, long tam);


---

0x09 — forquilhar

Cria novo processo.

long forquilhar(void);


---

0x0A — executar

Substitui imagem do processo.

long executar(const char* caminho, char* const argv[]);


---

0x0B — esperar

Espera processo filho.

long esperar(int* status);


---

0x0C — tempo

Obtém tempo do sistema.

long tempo(long* seg, long* nseg);


---

0x0D — info

Consulta informações do kernel.

long info(int tipo, void* buf);


---

Descritores

0 → entrada padrão

1 → saída padrão

2 → erro padrão


Tudo é arquivo.


---

Regras de Estabilidade

Syscalls nunca mudam sem quebrar ABI

Novas syscalls só são adicionadas

Números são definitivos



---

Testes Obrigatórios

chamada inválida retorna erro

argumentos nulos tratados

stress de chamadas rápidas



---

Este documento é normativo.